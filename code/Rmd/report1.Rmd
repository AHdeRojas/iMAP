---
title: "Progress report 1"
bibliography: ../../library/imap.bib
date: 'Updated: `r Sys.time()`'
output:
  html_document:
    css: ../../code/css/report.css
    # keep_md: yes
link-citations: yes
subtitle: Metadata profiling
biblio-style: apalike

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.path='./images/', fig.show='asis',  dev = 'png', fig.align='center', out.width = "80%",  out.height = "80%", echo=TRUE, comment = NA, warning=FALSE, message=FALSE)
# knitr::opts_chunk$set(fig.path='./images/pdf/', fig.show='asis',  dev = 'pdf', fig.align='center', out.width = "80%",  out.height = "80%", echo=TRUE, comment = NA, warning=FALSE, message=FALSE)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(comment = NA)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
load("./Rpackages.RData")
load("./functions.RData")
```

<br>


```{r include=FALSE}

samplemetadata <- readr::read_table2(file="../../data/metadata/samplemetadata.tsv", col_names = T)
colnames(samplemetadata)[1] <- "SampleID"

metadata_status <- funModeling::df_status(samplemetadata)

# Subsetting metadata for mapping to output from dowmstream analysis
library(dplyr)
variables <- samplemetadata %>% dplyr::select("SampleID", "origID", "Sex", "Time", "DayID", "DPW")
names(variables)[2] <- "origID"
```


## Status of metadata

<hr>


```{r message=FALSE, warning=FALSE}
library(dplyr)
# library(kableExtra)

# show data
metadata_status %>% knitr::kable() 
# %>%
#   kable_styling(bootstrap_options = "striped", full_width = T)

```

Key: **q_zeros**: quantity of missing data; **p_zeros**: percentage of missing data, **q_na**: quantity of NA; **p_na**: percentage of NA, **q_inf**: quantity of infinite values; **p_inf**: percentage of infinity values,  **type**: factor, character, integer or numeric; **unique**: frequency of the values.


When reviewing metadata status you may notice that numeric variables are confused with numeric data. For example, variable **DPW** (days post weaning) on Table x shows 12 missing values (3.33%) which is incorrect. As investigators we know that day 1 was coded zero (0) (12 zeros for 12 mouse) which in descriptive statistics is interpreted as missing data. To correct this we re-coded the samples with unique identifies shown as DayID to distinguish them from integers. However, depending of experiment this kind of variables need to be converted to character during analysis. 

<br>

## Samples mapped to the categorical variables

<hr>

**First 5 lines of mapping metadata**

```{r message=FALSE, warning=FALSE}

variables %>% head(5)  %>% knitr::kable() 
# %>%
  # kable_styling(bootstrap_options = "striped", full_width = T)
```

<br>


**Last 5 lines of mapping metadata**

```{r message=FALSE, warning=FALSE}

variables %>% tail(5)  %>% knitr::kable() 
# %>%
  # kable_styling(bootstrap_options = "striped", full_width = T)
```

<br>

## Frequency of experimental variables (Demo dataset)

<hr>


```{r varfreq, fig.height=8, fig.width=8, message=FALSE, warning=FALSE}
library(ggplot2)
#sort by dpw (descending)


variables <- variables[order(variables$DPW),] 

sexhistplot <- ggpubr::gghistogram(variables, x = "Sex", stat="count", fill = "#ff0000") + ggtitle("Sex variable")

timehistplot <- ggpubr::gghistogram(variables, x = "Time", stat="count", fill = "#00ff00") + ggtitle("Time variable")

# scaleFUN <- function(x) sprintf("%.0f", x)

dpwhistplot <- ggpubr::gghistogram(variables, x = "DayID", stat="count", fill = "#0000ff") + ggtitle("Days post weaning")+
  theme(axis.text.x=element_text(angle = 90, hjust = 0))+ scale_y_continuous(labels=scaleFUN)

ggpubr::ggarrange(sexhistplot,timehistplot, dpwhistplot, ncol = 1, nrow = 3,  common.legend = TRUE, legend = "top", align = "hv", labels = c(""))
```

## Posible questions

<hr>

### Metadata profiling 

* QN1: Are there samples to be removed from the analysis based on their count?
* QN2: Are there enough variables for downstream diversity and statistical analysis?
* QN3: .......?
* QN4: .......?
* QN5: .......?

<br>

## Summary of packages used in the analysis
```{r}
sessionInfo()
```

<br>

